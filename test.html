<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="referrer" content="no-referrer-when-downgrade">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>Telegram Mini App Test</title>
</head>
<body style="font-family: sans-serif; text-align: center; margin-top: 40px;">
  <h2>üöÄ Telegram WebApp –¢–µ—Å—Ç</h2>
  <button id="sendBtn" style="padding:10px 20px; font-size:16px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

  <p id="status" style="color: gray; margin-top: 20px;"></p>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
    const status = document.getElementById("status");
    status.innerText = "‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω";

    document.getElementById("sendBtn").addEventListener("click", () => {
      const data = { message: "ping", time: new Date().toISOString() };
      console.log("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram:", data);

      try {
        tg.sendData(JSON.stringify(data));
        status.innerText = "üì® –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram";
        tg.close();
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:", err);
        status.innerText = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö";
      }
    });

    // –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ Mini App –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ Telegram
    if (!tg.initData || tg.initData === "") {
      alert("‚ö†Ô∏è –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞!");
      status.innerText = "‚ö†Ô∏è –ù–µ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ Telegram";
    }
  </script>
</body>
</html>

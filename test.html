<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>MiniApp ‚Äî —Ç–µ—Å—Ç</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    button { padding: 10px 14px; font-size: 16px; }
    #status { margin-top: 12px; color: #333; }
  </style>
</head>
<body>
  <h2>–ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç</h2>

  <p>–≠—Ç–æ —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É.</p>

  <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å ping</button>
  <div id="status"></div>

  <script>
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –≤ Telegram
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

    const statusEl = document.getElementById("status");
    function setStatus(s){
      statusEl.innerText = s;
    }

    if (!tg) {
      // –Ω–µ –≤–Ω—É—Ç—Ä–∏ Telegram WebApp
      alert("‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram (–∫–Ω–æ–ø–∫—É –±–æ—Ç–∞). –í –±—Ä–∞—É–∑–µ—Ä–µ sendData –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç.");
      setStatus("–û—Ç–∫—Ä—ã—Ç–æ –≤–Ω–µ Telegram ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.");
    } else {
      console.log("initData:", tg.initData);
      tg.ready();
      try { tg.expand(); } catch (e) { /*ignore*/ }

      const sendBtn = document.getElementById("sendBtn");

      sendBtn.addEventListener("click", async () => {
        const data = {
          ping: "pong",
          // –ø—Ä–∏–º–µ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
          // hotel: "–ê–ª—å—Ñ–∞",
          // category: "–°—Ç–∞–Ω–¥–∞—Ä—Ç",
          // firstName: "–ò–≤–∞–Ω",
          // lastName: "–ò–≤–∞–Ω–æ–≤",
        };

        setStatus("–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...");
        console.log("üëâ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram:", data);

        try {
          // sendData –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Telegram WebApp
          if (typeof tg.sendData === "function") {
            tg.sendData(JSON.stringify(data)); // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç–∞
            setStatus("–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã. Mini App –±—É–¥–µ—Ç –∑–∞–∫—Ä—ã—Ç.");
            // –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –¥–∞—Ç—å –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–µ
            setTimeout(() => {
              try { tg.close(); } catch (e) { console.error(e); }
            }, 300);
          } else {
            setStatus("–û—à–∏–±–∫–∞: tg.sendData –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–º –∫–ª–∏–µ–Ω—Ç–µ.");
            console.error("tg.sendData is not a function");
          }
        } catch (err) {
          console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:", err);
          setStatus("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö: " + err.toString());
        }
      });

      // –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –ø—Ä—è–º–æ–π URL),
      // —Ç–æ initData –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
      if (!tg.initData || tg.initData === "") {
        // —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–µ–º, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º
        console.warn("Warning: initData is empty (app probably opened not from bot). sendData –≤—Å—ë —Ä–∞–≤–Ω–æ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∏–∑ –±–æ—Ç–∞.");
        // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ –≤ —Å—Ç–∞—Ç—É—Å–µ –Ω–∞ UI
        setStatus("–í–Ω–∏–º–∞–Ω–∏–µ: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –∏–∑ Telegram-–∫–Ω–æ–ø–∫–∏ –±–æ—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.");
      }
    }
  </script>
</body>
</html>

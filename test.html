<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="referrer" content="no-referrer-when-downgrade">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>Telegram WebApp Debug</title>
</head>
<body style="font-family: sans-serif; padding: 20px;">

  <h2>üß© Telegram Mini App ‚Äî –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>

  <button id="sendBtn" style="padding: 10px 20px; font-size: 16px;">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

  <h3>–°—Ç–∞—Ç—É—Å:</h3>
  <pre id="status" style="background:#f2f2f2; padding:10px; border-radius:8px; white-space:pre-wrap;"></pre>

  <h3>initData:</h3>
  <pre id="initData" style="background:#e8f5e9; padding:10px; border-radius:8px; white-space:pre-wrap;"></pre>

  <h3>initDataUnsafe:</h3>
  <pre id="initDataUnsafe" style="background:#fff3e0; padding:10px; border-radius:8px; white-space:pre-wrap;"></pre>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const statusBox = document.getElementById("status");
    const initBox = document.getElementById("initData");
    const unsafeBox = document.getElementById("initDataUnsafe");

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    initBox.textContent = tg.initData || "(–ø—É—Å—Ç–æ)";
    unsafeBox.textContent = JSON.stringify(tg.initDataUnsafe || {}, null, 2);

    if (tg.initData && tg.initData.length > 0) {
      statusBox.textContent = "‚úÖ WebApp –æ—Ç–∫—Ä—ã—Ç —á–µ—Ä–µ–∑ Telegram.\n–ì–æ—Ç–æ–≤ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö.";
    } else {
      statusBox.textContent = "‚ö†Ô∏è –ü–æ—Ö–æ–∂–µ, —á—Ç–æ WebApp –æ—Ç–∫—Ä—ã—Ç –Ω–µ –∏–∑ Telegram!";
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
    document.getElementById("sendBtn").addEventListener("click", () => {
      const data = {
        ping: "pong",
        time: new Date().toISOString(),
        user: tg.initDataUnsafe?.user?.username || "–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω"
      };

      console.log("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º:", data);
      statusBox.textContent += "\nüì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...";

      try {
        tg.sendData(JSON.stringify(data));
        statusBox.textContent += "\n‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram (–≤—ã–∑–≤–∞–Ω sendData()).";
        tg.close();
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ sendData:", err);
        statusBox.textContent += "\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ sendData(): " + err.message;
      }
    });
  </script>
</body>
</html>

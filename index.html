<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --tg-theme-bg-color: #ffffff;
      --tg-theme-text-color: #000000;
      --tg-theme-button-color: #3390ec;
      --tg-theme-button-text-color: #ffffff;
      --tg-theme-hint-color: #999999;
      --border-color: #e0e0e0;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
      font-size: 16px;
      line-height: 1.5;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
      text-align: center;
    }

    .form-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    select, input[type="text"], input[type="email"], input[type="tel"], input[type="date"], input[type="number"], textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      background: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
      font-size: 16px;
      box-sizing: border-box;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    button {
      width: 100%;
      padding: 14px;
      background-color: var(--tg-theme-button-color);
      color: var(--tg-theme-button-text-color);
      border: none;
      border-radius: 10px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .error {
      color: #ff4444;
      font-size: 14px;
      margin-top: 8px;
    }

    .name-row, .passport-row {
      display: flex;
      gap: 12px;
    }

    .name-row .form-group, .passport-row .form-group {
      flex: 1;
      margin-bottom: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè® –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞</h1>

    <!-- –í—ã–±–æ—Ä –≥–æ—Å—Ç–∏–Ω–∏—Ü—ã -->
    <div class="form-group">
      <label for="hotel">–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞ *</label>
      <select id="hotel" required>
        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
        <option value="–ê–ª—å—Ñ–∞">–ê–ª—å—Ñ–∞</option>
        <option value="–ë–µ—Ç–∞">–ë–µ—Ç–∞</option>
        <option value="–ì–∞–º–º–∞">–ì–∞–º–º–∞</option>
      </select>
    </div>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è) -->
    <div class="form-group">
      <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–º–µ—Ä–∞ *</label>
      <select id="category" required disabled>
        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç–∏–Ω–∏—Ü—É</option>
      </select>
    </div>

    <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π -->
    <div class="form-group">
      <label for="guests">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π *</label>
      <input type="number" id="guests" min="1" max="2" value="1" required disabled />
      <div id="guestsError" class="error"></div>
    </div>

    <!-- –§–ò–û -->
    <div class="name-row">
      <div class="form-group">
        <label for="lastName">–§–∞–º–∏–ª–∏—è *</label>
        <input type="text" id="lastName" placeholder="–ò–≤–∞–Ω–æ–≤" maxlength="50" required disabled />
      </div>
      <div class="form-group">
        <label for="firstName">–ò–º—è *</label>
        <input type="text" id="firstName" placeholder="–ò–≤–∞–Ω" maxlength="50" required disabled />
      </div>
    </div>
    <div class="form-group">
      <label for="middleName">–û—Ç—á–µ—Å—Ç–≤–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
      <input type="text" id="middleName" placeholder="–ò–≤–∞–Ω–æ–≤–∏—á" maxlength="50" disabled />
    </div>

    <!-- Email -->
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" placeholder="ivan@example.com" maxlength="100" disabled />
    </div>

    <!-- –ü–∞—Å–ø–æ—Ä—Ç -->
    <div class="passport-row">
      <div class="form-group">
        <label for="passportSeries">–°–µ—Ä–∏—è *</label>
        <input type="text" id="passportSeries" placeholder="1234" maxlength="4" required disabled />
      </div>
      <div class="form-group">
        <label for="passportNumber">–ù–æ–º–µ—Ä *</label>
        <input type="text" id="passportNumber" placeholder="567890" maxlength="6" required disabled />
      </div>
    </div>

    <div class="form-group">
      <label for="issueDate">–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ *</label>
      <input type="date" id="issueDate" required disabled />
    </div>

    <div class="form-group">
      <label for="issuedBy">–ö–µ–º –≤—ã–¥–∞–Ω *</label>
      <input type="text" id="issuedBy" placeholder="–û–í–î —Ä–∞–π–æ–Ω–∞, –≥. –ú–æ—Å–∫–≤–∞" maxlength="200" required disabled />
    </div>

    <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
    <div class="form-group">
      <label for="phone">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω *</label>
      <input type="tel" id="phone" placeholder="+7 (999) 123-45-67" required disabled />
    </div>

    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
    <div class="form-group">
      <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</label>
      <textarea id="comment" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω—É–∂–Ω–∞ –¥–µ—Ç—Å–∫–∞—è –∫—Ä–æ–≤–∞—Ç–∫–∞" disabled></textarea>
    </div>

    <!-- –î–∞—Ç—ã -->
    <div class="form-group">
      <label for="checkin">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞ *</label>
      <input type="date" id="checkin" required disabled />
    </div>

    <div class="form-group">
      <label for="checkout">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞ *</label>
      <input type="date" id="checkout" required disabled />
      <div id="dateError" class="error"></div>
    </div>

    <button id="bookBtn" disabled>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script>
    const WebApp = window.Telegram.WebApp;
    WebApp.ready();
    WebApp.expand();

    // –¢–µ–º—ã
    document.documentElement.style.setProperty('--tg-theme-bg-color', WebApp.backgroundColor || '#ffffff');
    document.documentElement.style.setProperty('--tg-theme-text-color', WebApp.textColor || '#000000');
    document.documentElement.style.setProperty('--tg-theme-button-color', WebApp.buttonColor || '#3390ec');
    document.documentElement.style.setProperty('--tg-theme-button-text-color', WebApp.buttonTextColor || '#ffffff');
    document.documentElement.style.setProperty('--tg-theme-hint-color', WebApp.hintColor || '#999999');

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Å—Ç–∏–Ω–∏—Ü (–¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å hotels.json)
    const HOTELS_CONFIG = {
      "–ê–ª—å—Ñ–∞": {
        categories: ["–°—Ç–∞–Ω–¥–∞—Ä—Ç", "–õ—é–∫—Å"],
        maxGuests: { "–°—Ç–∞–Ω–¥–∞—Ä—Ç": 2, "–õ—é–∫—Å": 4 }
      },
      "–ë–µ—Ç–∞": {
        categories: ["–°—Ç–∞–Ω–¥–∞—Ä—Ç", "–ü–æ–ª—É–ª—é–∫—Å", "–õ—é–∫—Å"],
        maxGuests: { "–°—Ç–∞–Ω–¥–∞—Ä—Ç": 2, "–ü–æ–ª—É–ª—é–∫—Å": 3, "–õ—é–∫—Å": 4 }
      },
      "–ì–∞–º–º–∞": {
        categories: ["–°—Ç–∞–Ω–¥–∞—Ä—Ç", "–°–µ–º–µ–π–Ω—ã–π"],
        maxGuests: { "–°—Ç–∞–Ω–¥–∞—Ä—Ç": 2, "–°–µ–º–µ–π–Ω—ã–π": 4 }
      }
    };

    const today = new Date().toISOString().split('T')[0];
    document.getElementById('issueDate').max = today;
    document.getElementById('checkin').min = today;
    document.getElementById('checkout').min = today;

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const hotelSelect = document.getElementById('hotel');
    const categorySelect = document.getElementById('category');
    const guestsInput = document.getElementById('guests');
    const formFields = document.querySelectorAll('input:not([type="radio"]), select, textarea');
    const bookBtn = document.getElementById('bookBtn');

    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª–µ–π –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –≥–æ—Å—Ç–∏–Ω–∏—Ü—ã
    hotelSelect.addEventListener('change', () => {
      const hotel = hotelSelect.value;
      categorySelect.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>';
      categorySelect.disabled = !hotel;

      if (hotel && HOTELS_CONFIG[hotel]) {
        HOTELS_CONFIG[hotel].categories.forEach(cat => {
          const opt = document.createElement('option');
          opt.value = cat;
          opt.textContent = cat;
          categorySelect.appendChild(opt);
        });
        enableFields(true);
      } else {
        enableFields(false);
      }
    });

    categorySelect.addEventListener('change', () => {
      const hotel = hotelSelect.value;
      const category = categorySelect.value;
      if (hotel && category && HOTELS_CONFIG[hotel]) {
        const max = HOTELS_CONFIG[hotel].maxGuests[category] || 2;
        guestsInput.max = max;
        guestsInput.value = Math.min(guestsInput.value, max);
      }
    });

    function enableFields(enable) {
      formFields.forEach(el => {
        if (el.id !== 'hotel') {
          el.disabled = !enable;
        }
      });
      bookBtn.disabled = !enable;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç
    document.getElementById('checkin').addEventListener('change', function () {
      document.getElementById('checkout').min = this.value || today;
    });

    // –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –≤ –ø–∞—Å–ø–æ—Ä—Ç–µ
    document.getElementById('passportSeries').addEventListener('input', function (e) {
      this.value = this.value.replace(/\D/g, '').slice(0, 4);
    });
    document.getElementById('passportNumber').addEventListener('input', function (e) {
      this.value = this.value.replace(/\D/g, '').slice(0, 6);
    });

    // –ú–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    document.getElementById('phone').addEventListener('input', function (e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.startsWith('8')) value = '7' + value.slice(1);
      if (!value.startsWith('7')) value = '7' + value;
      let formatted = '+7';
      if (value.length > 1) formatted += ' (' + value.slice(1, 4);
      if (value.length >= 4) formatted += ') ' + value.slice(4, 7);
      if (value.length >= 7) formatted += '-' + value.slice(7, 9);
      if (value.length >= 9) formatted += '-' + value.slice(9, 11);
      e.target.value = formatted;
    });

    // –û—Ç–ø—Ä–∞–≤–∫–∞
    bookBtn.addEventListener('click', () => {
      const hotel = hotelSelect.value;
      const category = categorySelect.value;
      const guests = parseInt(document.getElementById('guests').value);
      const lastName = document.getElementById('lastName').value.trim();
      const firstName = document.getElementById('firstName').value.trim();
      const middleName = document.getElementById('middleName').value.trim() || null;
      const email = document.getElementById('email').value.trim() || null;
      const passportSeries = document.getElementById('passportSeries').value;
      const passportNumber = document.getElementById('passportNumber').value;
      const issueDate = document.getElementById('issueDate').value;
      const issuedBy = document.getElementById('issuedBy').value.trim();
      const phoneRaw = document.getElementById('phone').value.replace(/\D/g, '');
      const comment = document.getElementById('comment').value.trim() || null;
      const checkin = document.getElementById('checkin').value;
      const checkout = document.getElementById('checkout').value;

      const guestsError = document.getElementById('guestsError');
      const dateError = document.getElementById('dateError');
      guestsError.textContent = '';
      dateError.textContent = '';

      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!hotel) { WebApp.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Å—Ç–∏–Ω–∏—Ü—É'); return; }
      if (!category) { WebApp.showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é'); return; }
      if (isNaN(guests) || guests < 1) { guestsError.textContent = '–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π'; return; }
      const maxGuests = HOTELS_CONFIG[hotel]?.maxGuests[category] || 2;
      if (guests > maxGuests) {
        guestsError.textContent = `–ú–∞–∫—Å–∏–º—É–º ${maxGuests} –≥–æ—Å—Ç–µ–π –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏`;
        return;
      }
      if (!lastName) { WebApp.showAlert('–§–∞–º–∏–ª–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞'); return; }
      if (!firstName) { WebApp.showAlert('–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ'); return; }
      if (passportSeries.length !== 4) { WebApp.showAlert('–°–µ—Ä–∏—è ‚Äî 4 —Ü–∏—Ñ—Ä—ã'); return; }
      if (passportNumber.length !== 6) { WebApp.showAlert('–ù–æ–º–µ—Ä ‚Äî 6 —Ü–∏—Ñ—Ä'); return; }
      if (!issueDate) { WebApp.showAlert('–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞'); return; }
      if (!issuedBy) { WebApp.showAlert('–£–∫–∞–∂–∏—Ç–µ, –∫–µ–º –≤—ã–¥–∞–Ω'); return; }
      if (phoneRaw.length < 11) { WebApp.showAlert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω'); return; }
      if (!checkin) { WebApp.showAlert('–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞'); return; }
      if (!checkout) { WebApp.showAlert('–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞'); return; }
      if (new Date(checkout) <= new Date(checkin)) {
        dateError.textContent = '–í—ã–µ–∑–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–∑–∂–µ –∑–∞–µ–∑–¥–∞';
        return;
      }
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        WebApp.showAlert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
        return;
      }

      WebApp.sendData(JSON.stringify({
        hotel,
        category,
        guests,
        lastName,
        firstName,
        middleName,
        email,
        passportSeries,
        passportNumber,
        issueDate,
        issuedBy,
        phone: '+7' + phoneRaw.slice(1),
        comment,
        checkin,
        checkout
      }));

      WebApp.close();
    });
  </script>
</body>
</html>